{"version":3,"sources":["index.js"],"names":["barDataset","songNames","countriesList","countriesName","Countries","slice","sort","barPadding","margin","top","right","bottom","left","w","h","y","d3","scaleBand","range","padding","x","scaleLinear","dataset","init","console","log","csv","then","data","slider","initSlider","filtered","filter","d","getDate","initGraph","updateGraph","select","insert","on","country","property","index","indexOf","fileName","document","getElementById","style","visibility","src","selectAll","enter","append","attr","text","toUpperCase","length","svg","updateSVG","fullSongNames","artistNames","remove","call","axisBottom","axisLeft","tickSize","tickFormat","i","parseInt","streams","updateBars","bars","merge","bandwidth","arrayObj","Streams","name","substring","domain","max","sliderTime","date","timeFormat","value","weeks2019","map","Date","months","sliderBottom","min","step","width","tickValues","displayValue","val","gTime"],"mappings":"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","file":"src.a7ce015a.js","sourceRoot":"../src","sourcesContent":["\n// globals\nvar countriesList = [\"ca\", \"dk\", \"gr\", \"is\", \"mx\", \"ph\", \"sv\",\n    \"ar\", \"ch\", \"do\", \"gt\", \"it\", \"my\", \"pl\", \"th\",\n    \"at\", \"cl\", \"ec\", \"hk\", \"jp\", \"pt\", \"tr\",\n    \"au\", \"co\", \"hn\", \"nl\", \"py\", \"tw\",\n    \"be\", \"cr\", \"es\", \"hu\", \"no\", \"ro\", \"us\",\n    \"fi\", \"id\", \"nz\", \"se\", \"uy\",\n    \"bo\", \"cz\", \"fr\", \"ie\", \"pa\", \"sg\", \"vn\",\n    \"br\", \"de\", \"gb\", \"il\", \"pe\", \"sk\", \"global\"];\n\nvar countriesName = [\"Canada\", \"Denmark\", \"Greece\", \"Iceland\", \"Mexico\", \"Philippines\", \"El Salvador\",\n    \"Argentina\", \"Switzerland\", \"Dominican Republic\", \"Guatemala\", \"Italy\", \"Malaysia\", \"Poland\", \"Thailand\",\n    \"Austria\", \"Chile\", \"Ecuador\", \"Hong Kong\", \"Japan\", \"Portugal\", \"Turkey\",\n    \"Australia\", \"Columbia\", \"Honduras\", \"Netherlands\", \"Paraguay\", \"Taiwan\",\n    \"Belgium\", \"Costa Rica\", \"Spain\", \"Hungary\", \"Norway\", \"Romania\", \"United States\",\n    \"Finland\", \"Indonesia\", \"New Zealand\", \"Sweden\", \"Uruguay\",\n    \"Bolivia\", \"Czech Republic\", \"France\", \"Ireland\", \"Panama\", \"Singapore\", \"Vietnam\",\n    \"Brazil\", \"Germany\", \"United Kingdom\", \"Israel\", \"Peru\", \"Slovakia\", \"global\"];\nvar Countries = (countriesName).slice(0).sort();\n\nvar barPadding = 1;\nvar margin = {\n    top: 15,\n    right: 25,\n    bottom: 30,\n    left: 10\n};\nvar w = 800 - margin.left - margin.right;\nvar h = 460 - margin.top - margin.bottom;\n\n//set x and y ranges\nvar y = d3.scaleBand()\n.range([h - 10, 0])\n.padding(0.1);\n\nvar x = d3.scaleLinear()\n.range([0, w]);\n\n\nvar dataset = [];\nvar barDataset;\nvar songNames;\n\n\n//--------------------------------// end globals\n\nfunction init() {\n    // load global data\n    console.log(\"init begin\");\n    d3.csv(\"streamsglobal10.csv\").then(function (data) {\n        console.log(\"load global data begin\");\n        slider.initSlider();\n        \n        dataset = data;\n        var filtered = data.filter(function (d) {\n            return d[\"date\"] === slider.getDate();\n        })\n        \n        initGraph();\n        updateGraph(filtered);\n\n        // update graph based on country dropdown\n        var countryDropdown = d3.select(\"#vis-container-country\")\n            .insert(\"select\", \"svg\")\n            .on(\"change\", function () {\n                var country = d3.select(this).property(\"value\");\n                var index = countriesName.indexOf(country);\n                var fileName = \"streams\" + countriesList[index] + \"10.csv\";\n\n                if(countriesList[index] == \"global\") {\n                    document.getElementById(\"flag\").style.visibility=\"hidden\"; \n                }\n                else {\n                    document.getElementById(\"flag\").src=\"https://cdn.ip2location.com/assets/img/flags/\" + countriesList[index] + \".png\";\n                    document.getElementById(\"flag\").style.visibility=\"visible\"; \n                }\n\n                // load new csv, and update graph\n                d3.csv(fileName).then(function (data) {\n                    dataset = data;\n                    var filtered = data.filter(function (d) {\n                        return d[\"date\"] === slider.getDate();\n                    })\n                    updateGraph(filtered);\n                });\n            });\n\n        // populate the country dropdown\n        countryDropdown.selectAll(\"option\")\n            .data(Countries)\n            .enter().append(\"option\")\n            .attr(\"value\", function (d) { return d; })\n            .attr(\"selected\", function (d) {\n                return d === \"Global\";\n            })\n            .text(function (d) {\n                return d[0].toUpperCase() + d.slice(1, d.length); // capitalize 1st letter\n            });\n        console.log(\"load global data end\");\n    });\n    console.log(\"init end\")\n}\n\nfunction initGraph() {\n    svg = d3.select(\"div#graph\")\n        .append(\"svg\")\n        .attr(\"width\", w + margin.left + margin.right)\n        .attr(\"height\", h + margin.top + margin.bottom)\n        .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n}\n\nfunction updateSVG(fullSongNames, barDataset, artistNames, songNames) {\n    svg.selectAll(\"text\").remove();\n\n    // update and add the x Axis\n    svg.selectAll(\"g\").remove();\n    svg.append(\"g\")\n        .attr(\"transform\", \"translate(0,\" + (h - 10) + \")\")\n        .attr(\"color\", \"white\")\n        .call(d3.axisBottom(x));\n\n    // add axis label\n    svg.append(\"text\")\n        .attr(\"transform\",\n            \"translate(\" + (w / 2) + \" ,\" +\n            (h + margin.top + 10) + \")\")\n        .attr(\"fill\", \"white\")\n        .attr(\"font-family\", \"sans-serif\")\n        .attr(\"font-size\", \"12px\")\n        .style(\"text-anchor\", \"middle\")\n        .text(\"Streams\");\n\n    // add the y Axis\n    svg.append(\"g\")\n        .call(d3.axisLeft(y).tickSize(0).tickFormat(\"\"));\n\n    svg.selectAll(\"title\").remove();\n    svg.selectAll(\"rect\")\n        .append(\"title\")\n        .text(function (d) {\n            var i = 10 - parseInt(d[1]);\n            return \"\\\"\" + fullSongNames[i] + \"\\\" by \" + artistNames[i] + \": \"\n                + d[0] + \" streams on \" + slider.getDate();\n        })\n\n    svg.selectAll(\"text.value\")\n        .data(barDataset)\n        .enter()\n        .append(\"text\")\n        .text(function (d) {\n            return songNames[parseInt(d[1]) - 1];\n        })\n        .attr(\"text-anchor\", \"end\")\n        .attr(\"y\", function (d, i) {\n            return (9 - i) * ((h - 14) / barDataset.length) + 26;\n        })\n        .attr(\"x\", function (d) {\n            var index = d[1];\n            var streams = barDataset[index - 1][0];\n            return x(streams) - 8;\n        })\n        .attr(\"font-family\", \"sans-serif\")\n        .attr(\"font-size\", \"12px\")\n        .attr(\"font-weight\", 550)\n        .attr(\"fill\",\"rgb(35, 35, 35)\")\n}\n\nfunction updateBars(barDataset) {\n    var bars = svg.selectAll(\"rect\")\n        .data(barDataset);\n\n    bars.enter().append(\"rect\")\n        .attr(\"class\", \"bar\")\n        .attr(\"fill\", function () {\n            return \"rgb(30, 215, 96)\";\n        })\n        .merge(bars)\n        .attr(\"x\", function (d) {\n \n            return x(d[1]);\n        })\n        .attr(\"y\", function (d) {\n            console.log(y)\n            console.log(d)\n            return y(d[1]);\n        })\n        .attr(\"width\", function (d) {\n            return x(d[0]);\n        })\n        .attr(\"height\", y.bandwidth());\n}\n\nfunction updateGraph(filtered) {\n    barDataset = [[]];\n    songNames = [\"\"];\n    var fullSongNames = [\"\"];\n    artistNames = [\"\"];\n\n    for (var i = 0; i < filtered.length; i++) {\n        var arrayObj = [parseInt(filtered[i].Streams), (10 - i) + \"\"];\n        var name = filtered[i][\"Track Name\"];\n        fullSongNames[i] = name;\n        if (filtered[i][\"Track Name\"].length > 30) {\n            name = name.substring(0, 31) + \"...\";\n        }\n        songNames[i] = name;\n        artistNames[i] = filtered[i][\"Artist\"];\n        barDataset[i] = arrayObj;\n    }\n\n    // Scale the range of the data in the domains\n    x.domain([0, d3.max(barDataset, function (d) { return d[0]; })])\n    y.domain(d3.range(1, barDataset.length + 1));\n\n    updateBars(barDataset)\n    updateSVG(fullSongNames, barDataset, artistNames, songNames);\n}\n\n\nslider = function () {\n    var sliderTime;\n    var date;\n\n    function playSlider() {\n\n    }\n\n    function getDate() {\n        return d3.timeFormat(\"%Y-%m-%d\")(sliderTime.value());\n    }\n\n    // Code inspired/provided by https://github.com/johnwalley/d3-simple-slider v1.5.4 Copyright 2019 John Walley\n    function initSlider() {\n        var weeks2019 = d3.range(0, 53).map(function (d) {\n            return new Date(2019, 0, 1 + 7 * d);\n        });\n\n        var months = d3.range(0, 12).map(function (d) {\n            return new Date(2019, d, 1);\n        });\n\n        sliderTime = d3\n            .sliderBottom()\n            .min(d3.min(weeks2019))\n            .max(d3.max(weeks2019))\n            .step(12)\n            .width(770 - margin.left - margin.right)\n            .tickValues(months)\n            .tickFormat(d3.timeFormat(\"%b\"))\n            .displayValue(false)\n            .on(\"onchange\", val => {\n                d3.select(\"div#date-display\").text(d3.timeFormat(\"%Y-%m-%d\")(val));\n                date = d3.timeFormat(\"%Y-%m-%d\")(val);\n\n                var filtered = dataset.filter(function (d) {\n                    for (var i = 0; i < dataset.length; i++) {\n                        return d[\"date\"] === date;\n                    }\n                })\n\n                updateGraph(filtered)\n            });\n\n        var gTime = d3\n            .select(\"div#slider\")\n            .append(\"svg\") \n            .attr(\"width\", 900 - margin.left - margin.right)\n            .attr(\"height\", 100 - margin.top - margin.bottom)\n            .append(\"g\")\n            .attr(\"transform\", \"translate(30,10)\");\n\n        gTime.call(sliderTime);\n        gTime.selectAll(\"text\").attr(\"dx\", \"-10px\").attr(\"dy\", \"-16px\");\n\n        // show date at very beginning\n        d3.select(\"div#date-display\").text(d3.timeFormat(\"%Y-%m-%d\")(sliderTime.value()));\n    }\n\n    return {\n        getDate: getDate,\n        initSlider: initSlider\n    }\n\n}();\n\ninit();\n"]}